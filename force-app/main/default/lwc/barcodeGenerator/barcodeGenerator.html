<template>
    <lightning-card title="Barcode Generator for Order Line Items">
        
        <!-- Order Selection -->
        <div class="slds-m-around_medium">
            <lightning-combobox
                name="orderSelect"
                label="Select Order"
                placeholder="Choose an order"
                options={orderOptions}
                onchange={handleOrderChange}
                class="slds-m-bottom_small">
            </lightning-combobox>
            
            <div class="slds-grid slds-gutters">
                <div class="slds-col">
                    <lightning-button 
                        label="Refresh" 
                        onclick={handleRefresh}>
                    </lightning-button>
                </div>
            </div>
        </div>

        <!-- Order Items Table -->
        <template if:true={hasOrderItems}>
            <div class="slds-m-around_medium">
                <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th scope="col">Product Name</th>
                            <th scope="col">Quantity</th>
                            <th scope="col">Unit Price</th>
                            <th scope="col">Location</th>
                            <th scope="col">Barcode</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={orderItems} for:item="item">
                            <tr key={item.Id}>
                                <td>{item.productName}</td>
                                <td>{item.quantity}</td>
                                <td>
                                    <lightning-formatted-number 
                                        value={item.unitPrice} 
                                        format-style="currency" 
                                        currency-code="USD">
                                    </lightning-formatted-number>
                                </td>
                                <td>
                                    <lightning-input 
                                        type="text" 
                                        value={item.location}
                                        data-id={item.id}
                                        onchange={handleLocationChange}
                                        placeholder="Enter location">
                                    </lightning-input>
                                </td>
                                <td>
                                    <template if:true={item.barcodeGenerated}>
                                        <span class="slds-badge slds-badge_success">Generated</span>
                                    </template>
                                    <template if:false={item.barcodeGenerated}>
                                        <span class="slds-badge">Not Generated</span>
                                    </template>
                                </td>
                                <td>
                                    <lightning-button 
                                        label="Generate" 
                                        onclick={handleGenerateBarcode}
                                        data-id={item.id}
                                        variant="brand">
                                    </lightning-button>
                                </td>
                            </tr>
                            <!-- Barcode Display Row -->
                            <template if:true={item.showBarcode}>
                                <tr key={item.barcodeKey}>
                                    <td colspan="6" class="barcode-cell">
                                        <div class="barcode-container">
                                            <div class="barcode-header">
                                                <strong>{item.productName}</strong>
                                            </div>
                                            <div class="barcode-text">
                                                Order: {item.orderNumber} | Item: {item.id}
                                            </div>
                                            <template if:true={item.barcodeImageData}>
                                                <img src={item.barcodeImageData} alt="Barcode" class="barcode-image" />
                                            </template>
                                            <template if:false={item.barcodeImageData}>
                                                <div class="barcode-fallback">
                                                    <p>Barcode not available - Demo Text:</p>
                                                    <pre>Order: 00000103
Item: F-150 Lightning
Code: ||| | || ||| | | ||| | ||</pre>
                                                </div>
                                            </template>
                                            <div class="barcode-text">
                                                {item.barcodeData}
                                            </div>
                                            <template if:true={item.location}>
                                                <div class="barcode-location">
                                                    Location: {item.location}
                                                </div>
                                            </template>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </template>
                    </tbody>
                </table>
            </div>
        </template>

        <!-- No Items Message -->
        <template if:false={hasOrderItems}>
            <div class="slds-m-around_medium">
                <p class="slds-text-color_weak">Select an Order to view line items.</p>
            </div>
        </template>

        <!-- Print Button -->
        <template if:true={hasGeneratedBarcodes}>
            <div class="slds-m-around_medium">
                <lightning-button 
                    label="Print All Barcodes" 
                    onclick={handlePrint}
                    variant="success">
                </lightning-button>
            </div>
        </template>

    </lightning-card>
</template>
