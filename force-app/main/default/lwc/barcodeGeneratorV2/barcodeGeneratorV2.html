<template>
    <lightning-card title="Barcode Generator V2.0" icon-name="custom:custom14">
        
        <div class="slds-m-around_medium">
            
            <!-- Section 1: Order Information -->
            <div class="slds-box slds-m-bottom_medium">
                <div class="slds-text-heading_small slds-m-bottom_x-small">
                    Order Information
                </div>
                <div class="slds-grid slds-wrap">
                    <div class="slds-col slds-size_1-of-2">
                        <div class="slds-text-body_small slds-text-color_weak">Order Number</div>
                        <div class="slds-text-body_regular">{orderNumber}</div>
                    </div>
                    <div class="slds-col slds-size_1-of-2">
                        <div class="slds-text-body_small slds-text-color_weak">Account</div>
                        <div class="slds-text-body_regular">{accountName}</div>
                    </div>
                </div>
            </div>
            
            <!-- Section 2: Order Barcode -->
            <div class="slds-box slds-m-bottom_medium">
                <div class="slds-text-heading_small slds-m-bottom_small">
                    Order Barcode
                </div>
                
                <!-- Generate Button (shows before barcode generated) -->
                <template if:false={orderBarcodeGenerated}>
                    <div class="slds-text-align_center slds-m-vertical_medium">
                        <lightning-button 
                            label="Generate Order Barcode" 
                            onclick={handleGenerateOrderBarcode}
                            variant="brand"
                            icon-name="utility:apex">
                        </lightning-button>
                    </div>
                </template>
                
                <!-- Barcode Display (shows after generation) -->
                <template if:true={orderBarcodeGenerated}>
                    <div class="barcode-container">
                        <div class="barcode-title">ORDER BARCODE</div>
                        <div class="barcode-subtitle">Order Level Tracking</div>
                        
                        <!-- SVG barcode will be inserted here -->
                        <div class="barcode-display">
                            <svg lwc:dom="manual" class="barcode-svg"></svg>
                        </div>
                        
                        <div class="barcode-label">Order: {orderNumber}</div>
                        <div class="barcode-sublabel">Account: {accountName}</div>
                    </div>
                    
                    <div class="slds-text-align_center slds-m-top_small">
                        <lightning-badge label="Barcode Generated" class="slds-badge_success"></lightning-badge>
                    </div>
                </template>
            </div>
            
<!-- Section 3: Product Barcodes -->
<div class="slds-box slds-m-bottom_medium">
    <div class="slds-text-heading_small slds-m-bottom_small">
        Product Barcodes
        <span class="slds-text-body_small slds-text-color_weak"> (Master barcode per product type)</span>
    </div>
    
    <!-- Generate Button (shows before products loaded) -->
    <template if:false={productsLoaded}>
        <div class="slds-text-align_center slds-m-vertical_medium">
            <lightning-button 
                label="Generate Product Barcodes" 
                onclick={handleGenerateProductBarcodes}
                variant="brand"
                icon-name="utility:products">
            </lightning-button>
        </div>
    </template>
    
    <!-- Products Display (shows after generation) -->
    <template if:true={productsLoaded}>
        <template if:true={hasProducts}>
            <!-- Products Grid -->
            <div class="products-grid">
                <template for:each={products} for:item="product">
                    <div key={product.productId} class="product-card">
                        <div class="product-header">
                            <lightning-icon icon-name="standard:product" size="small"></lightning-icon>
                            <span class="product-name">{product.productName}</span>
                        </div>
                        
                        <!-- Product Barcode -->
                        <div class="barcode-container-small">
                            <div class="barcode-subtitle">Product Master Barcode</div>
                            <div class="barcode-display-small">
                                <svg lwc:dom="manual" class="barcode-svg-product" data-product-id={product.productId}></svg>
                            </div>
                            <div class="barcode-label-small">Product: {product.productName}</div>
                            <div class="barcode-sublabel">ID: {product.productId}</div>
                        </div>
                    </div>
                </template>
            </div>
            
            <div class="slds-text-align_center slds-m-top_small">
                <lightning-badge label=" Product Barcode Generated" class="slds-badge_success"></lightning-badge>
            </div>
        </template>
        
        <!-- No Products Message -->
        <template if:false={hasProducts}>
            <div class="slds-text-align_center slds-text-color_weak slds-m-vertical_medium">
                No products found in this order.
            </div>
        </template>
    </template>
</div>

<!-- Section 4: Line Item Barcodes -->
<div class="slds-box slds-m-bottom_medium">
    <div class="slds-text-heading_small slds-m-bottom_small">
        Line Item Barcodes
        <span class="slds-text-body_small slds-text-color_weak"> (Unique barcode per order item)</span>
    </div>
    
    <!-- Generate Button (shows before line items loaded) -->
    <template if:false={lineItemsLoaded}>
        <div class="slds-text-align_center slds-m-vertical_medium">
            <lightning-button 
                label="Generate Line Item Barcodes" 
                onclick={handleGenerateLineItemBarcodes}
                variant="brand"
                icon-name="utility:receipt">
            </lightning-button>
        </div>
    </template>
    
    <!-- Line Items Display (shows after generation) -->
    <template if:true={lineItemsLoaded}>
        <template if:true={hasLineItems}>
            
            <!-- Line Items Table -->
            <div class="line-items-table">
                <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                    <thead>
                        <tr class="slds-line-height_reset">
                            <th scope="col" style="width: 30%;">
                                <div class="slds-truncate" title="Product">Product</div>
                            </th>
                            <th scope="col" style="width: 10%;">
                                <div class="slds-truncate" title="Quantity">Qty</div>
                            </th>
                            <th scope="col" style="width: 15%;">
                                <div class="slds-truncate" title="Unit Price">Unit Price</div>
                            </th>
                            <th scope="col" style="width: 45%;">
                                <div class="slds-truncate" title="Line Item Barcode">Line Item Barcode</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={lineItems} for:item="lineItem">
                            <tr key={lineItem.Id} class="slds-hint-parent">
                                <td data-label="Product">
                                    <div class="slds-truncate" title={lineItem.Product2.Name}>
                                        <lightning-icon icon-name="standard:product_item" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                        {lineItem.Product2.Name}
                                    </div>
                                </td>
                                <td data-label="Quantity">
                                    <div class="slds-truncate" title={lineItem.Quantity}>
                                        {lineItem.Quantity}
                                    </div>
                                </td>
                                <td data-label="Unit Price">
                                    <div class="slds-truncate" title={lineItem.formattedPrice}>
                                        {lineItem.formattedPrice}
                                    </div>
                                </td>
                                <td data-label="Line Item Barcode">
                                    <div class="barcode-cell">
                                        <svg lwc:dom="manual" class="barcode-svg-lineitem" data-lineitem-id={lineItem.Id}></svg>
                                        <div class="barcode-id-label">ID: {lineItem.shortId}</div>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
            
            <div class="slds-text-align_center slds-m-top_small">
                <lightning-badge label="Line Item Barcode(s) Generated" class="slds-badge_success"></lightning-badge>
            </div>
        </template>
        
        <!-- No Line Items Message -->
        <template if:false={hasLineItems}>
            <div class="slds-text-align_center slds-text-color_weak slds-m-vertical_medium">
                No line items found in this order.
            </div>
        </template>
    </template>
</div>

<!-- Section 5: Coming Soon (Print) -->
<div class="slds-box slds-m-bottom_medium" style="background: #f3f3f3;">
    <div class="slds-text-heading_small slds-m-bottom_x-small">
        Coming in Next Pieces
    </div>
    <ul class="slds-list_dotted">
        <li>Invoice Button (Piece 6)</li>
        <li>Invoice PDF Generation (Piece 7)</li>
        <li>Print Functionality</li>
    </ul>
</div>

            <!-- Action Buttons -->
            <div class="slds-text-align_center slds-m-top_medium">
    <lightning-button-group>
        <lightning-button 
            label="Generate Invoice" 
            onclick={handleGenerateInvoice}
            variant="brand"
            icon-name="utility:file"
            disabled={isGeneratingInvoice}>
        </lightning-button>
        <lightning-button 
            label="Close" 
            onclick={handleClose}
            variant="neutral">
        </lightning-button>
    </lightning-button-group>
</div>

<!-- Invoice Status Messages -->
<template if:true={showInvoiceSuccess}>
    <div class="slds-m-top_small">
        <lightning-badge label="Invoice Generated Successfully!" class="slds-badge_success"></lightning-badge>
    </div>
</template>

<template if:true={isGeneratingInvoice}>
    <div class="slds-m-top_small">
        <lightning-spinner alternative-text="Generating invoice..." size="small"></lightning-spinner>
        <div class="slds-text-align_center slds-text-color_weak slds-m-top_x-small">
            Generating invoice with all barcodes...
        </div>
    </div>
</template>

        </div>
    </lightning-card>
</template>
